<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>IGA framework: /home/juan/xul_ga/igap/_yaml_/reader.py Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.3 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="namespaces.html"><span>Namespaces</span></a></li>
    <li><a href="annotated.html"><span>Classes</span></a></li>
    <li class="current"><a href="files.html"><span>Files</span></a></li>
  </ul>
</div>
<h1>/home/juan/xul_ga/igap/_yaml_/reader.py</h1><a href="reader_8py.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a><a class="code" href="namespace__yaml___1_1reader.html">00001</a> <span class="comment"># This module contains abstractions for the input stream. You don't have to</span>
<a name="l00002"></a>00002 <span class="comment"># looks further, there are no pretty code.</span>
<a name="l00003"></a>00003 <span class="comment">#</span>
<a name="l00004"></a>00004 <span class="comment"># We define two classes here.</span>
<a name="l00005"></a>00005 <span class="comment">#</span>
<a name="l00006"></a>00006 <span class="comment">#   Mark(source, line, column)</span>
<a name="l00007"></a>00007 <span class="comment"># It's just a record and its only use is producing nice error messages.</span>
<a name="l00008"></a>00008 <span class="comment"># Parser does not use it for any other purposes.</span>
<a name="l00009"></a>00009 <span class="comment">#</span>
<a name="l00010"></a>00010 <span class="comment">#   Reader(source, data)</span>
<a name="l00011"></a>00011 <span class="comment"># Reader determines the encoding of `data` and converts it to unicode.</span>
<a name="l00012"></a>00012 <span class="comment"># Reader provides the following methods and attributes:</span>
<a name="l00013"></a>00013 <span class="comment">#   reader.peek(length=1) - return the next `length` characters</span>
<a name="l00014"></a>00014 <span class="comment">#   reader.forward(length=1) - move the current position to `length` characters.</span>
<a name="l00015"></a>00015 <span class="comment">#   reader.index - the number of the current character.</span>
<a name="l00016"></a>00016 <span class="comment">#   reader.line, stream.column - the line and the column of the current character.</span>
<a name="l00017"></a>00017 
<a name="l00018"></a><a class="code" href="namespace__yaml___1_1reader.html#e87ba0f5483ec60fd86a0ecaf43d76b8">00018</a> __all__ = [<span class="stringliteral">'Reader'</span>, <span class="stringliteral">'ReaderError'</span>]
<a name="l00019"></a>00019 
<a name="l00020"></a>00020 <span class="keyword">from</span> error <span class="keyword">import</span> YAMLError, Mark
<a name="l00021"></a>00021 
<a name="l00022"></a>00022 <span class="keyword">import</span> codecs, re
<a name="l00023"></a>00023 
<a name="l00024"></a>00024 <span class="comment"># Unfortunately, codec functions in Python 2.3 does not support the `finish`</span>
<a name="l00025"></a>00025 <span class="comment"># arguments, so we have to write our own wrappers.</span>
<a name="l00026"></a>00026 
<a name="l00027"></a>00027 <span class="keywordflow">try</span>:
<a name="l00028"></a>00028     codecs.utf_8_decode(<span class="stringliteral">''</span>, <span class="stringliteral">'strict'</span>, <span class="keyword">False</span>)
<a name="l00029"></a>00029     <span class="keyword">from</span> codecs <span class="keyword">import</span> utf_8_decode, utf_16_le_decode, utf_16_be_decode
<a name="l00030"></a>00030 
<a name="l00031"></a>00031 <span class="keywordflow">except</span> TypeError:
<a name="l00032"></a>00032 
<a name="l00033"></a><a class="code" href="namespace__yaml___1_1reader.html#e7a2e6f258df3593c4cc9da685cfa72d">00033</a>     <span class="keyword">def </span><a class="code" href="namespace__yaml___1_1reader.html#e7a2e6f258df3593c4cc9da685cfa72d">utf_16_le_decode</a>(data, errors, finish=False):
<a name="l00034"></a>00034         <span class="keywordflow">if</span> <span class="keywordflow">not</span> finish <span class="keywordflow">and</span> len(data) % 2 == 1:
<a name="l00035"></a>00035             data = data[:-1]
<a name="l00036"></a>00036         <span class="keywordflow">return</span> codecs.utf_16_le_decode(data, errors)
<a name="l00037"></a>00037 
<a name="l00038"></a><a class="code" href="namespace__yaml___1_1reader.html#57ce63dd7241871311b98092e548e8b4">00038</a>     <span class="keyword">def </span><a class="code" href="namespace__yaml___1_1reader.html#57ce63dd7241871311b98092e548e8b4">utf_16_be_decode</a>(data, errors, finish=False):
<a name="l00039"></a>00039         <span class="keywordflow">if</span> <span class="keywordflow">not</span> finish <span class="keywordflow">and</span> len(data) % 2 == 1:
<a name="l00040"></a>00040             data = data[:-1]
<a name="l00041"></a>00041         <span class="keywordflow">return</span> codecs.utf_16_be_decode(data, errors)
<a name="l00042"></a>00042 
<a name="l00043"></a><a class="code" href="namespace__yaml___1_1reader.html#5fd7d1664804a39904d97992b9e24255">00043</a>     <span class="keyword">def </span><a class="code" href="namespace__yaml___1_1reader.html#5fd7d1664804a39904d97992b9e24255">utf_8_decode</a>(data, errors, finish=False):
<a name="l00044"></a>00044         <span class="keywordflow">if</span> <span class="keywordflow">not</span> finish:
<a name="l00045"></a>00045             <span class="comment"># We are trying to remove a possible incomplete multibyte character</span>
<a name="l00046"></a>00046             <span class="comment"># from the suffix of the data.</span>
<a name="l00047"></a>00047             <span class="comment"># The first byte of a multi-byte sequence is in the range 0xc0 to 0xfd.</span>
<a name="l00048"></a>00048             <span class="comment"># All further bytes are in the range 0x80 to 0xbf.</span>
<a name="l00049"></a>00049             <span class="comment"># UTF-8 encoded UCS characters may be up to six bytes long.</span>
<a name="l00050"></a>00050             count = 0
<a name="l00051"></a>00051             <span class="keywordflow">while</span> count &lt; 5 <span class="keywordflow">and</span> count &lt; len(data)   \
<a name="l00052"></a>00052                     <span class="keywordflow">and</span> <span class="stringliteral">'\x80'</span> &lt;= data[-count-1] &lt;= <span class="stringliteral">'\xBF'</span>:
<a name="l00053"></a>00053                 count -= 1
<a name="l00054"></a>00054             <span class="keywordflow">if</span> count &lt; 5 <span class="keywordflow">and</span> count &lt; len(data)  \
<a name="l00055"></a>00055                     <span class="keywordflow">and</span> <span class="stringliteral">'\xC0'</span> &lt;= data[-count-1] &lt;= <span class="stringliteral">'\xFD'</span>:
<a name="l00056"></a>00056                 data = data[:-count-1]
<a name="l00057"></a>00057         <span class="keywordflow">return</span> codecs.utf_8_decode(data, errors)
<a name="l00058"></a>00058 
<a name="l00059"></a><a class="code" href="class__yaml___1_1reader_1_1ReaderError.html">00059</a> <span class="keyword">class </span><a class="code" href="class__yaml___1_1reader_1_1ReaderError.html">ReaderError</a>(YAMLError):
<a name="l00060"></a>00060 
<a name="l00061"></a><a class="code" href="class__yaml___1_1reader_1_1ReaderError.html#fe6a21aa225ff378e9bef3ccaf0d8889">00061</a>     <span class="keyword">def </span><a class="code" href="class__yaml___1_1reader_1_1ReaderError.html#fe6a21aa225ff378e9bef3ccaf0d8889">__init__</a>(self, name, position, character, encoding, reason):
<a name="l00062"></a><a class="code" href="class__yaml___1_1reader_1_1ReaderError.html#ebf485513c9f0fc822cefabd090c778c">00062</a>         self.<a class="code" href="class__yaml___1_1reader_1_1ReaderError.html#ebf485513c9f0fc822cefabd090c778c">name</a> = name
<a name="l00063"></a><a class="code" href="class__yaml___1_1reader_1_1ReaderError.html#30cc034006de77309894f1487090ed9d">00063</a>         self.<a class="code" href="class__yaml___1_1reader_1_1ReaderError.html#30cc034006de77309894f1487090ed9d">character</a> = character
<a name="l00064"></a><a class="code" href="class__yaml___1_1reader_1_1ReaderError.html#397935230abed05bed62ade1f17b4350">00064</a>         self.<a class="code" href="class__yaml___1_1reader_1_1ReaderError.html#397935230abed05bed62ade1f17b4350">position</a> = position
<a name="l00065"></a><a class="code" href="class__yaml___1_1reader_1_1ReaderError.html#bff110ccbe0f56329f982d105ca74b40">00065</a>         self.<a class="code" href="class__yaml___1_1reader_1_1ReaderError.html#bff110ccbe0f56329f982d105ca74b40">encoding</a> = encoding
<a name="l00066"></a><a class="code" href="class__yaml___1_1reader_1_1ReaderError.html#dbe23c3b4100c06ca07c8419e2760e84">00066</a>         self.<a class="code" href="class__yaml___1_1reader_1_1ReaderError.html#dbe23c3b4100c06ca07c8419e2760e84">reason</a> = reason
<a name="l00067"></a>00067 
<a name="l00068"></a><a class="code" href="class__yaml___1_1reader_1_1ReaderError.html#7cf6fa8857ab8cff3da440d52af663a5">00068</a>     <span class="keyword">def </span><a class="code" href="class__yaml___1_1reader_1_1ReaderError.html#7cf6fa8857ab8cff3da440d52af663a5">__str__</a>(self):
<a name="l00069"></a>00069         <span class="keywordflow">if</span> isinstance(self.<a class="code" href="class__yaml___1_1reader_1_1ReaderError.html#30cc034006de77309894f1487090ed9d">character</a>, str):
<a name="l00070"></a>00070             <span class="keywordflow">return</span> <span class="stringliteral">"'%s' codec can't decode byte #x%02x: %s\n"</span>  \
<a name="l00071"></a>00071                     <span class="stringliteral">"  in \"%s\", position %d"</span>    \
<a name="l00072"></a>00072                     % (self.<a class="code" href="class__yaml___1_1reader_1_1ReaderError.html#bff110ccbe0f56329f982d105ca74b40">encoding</a>, ord(self.<a class="code" href="class__yaml___1_1reader_1_1ReaderError.html#30cc034006de77309894f1487090ed9d">character</a>), self.<a class="code" href="class__yaml___1_1reader_1_1ReaderError.html#dbe23c3b4100c06ca07c8419e2760e84">reason</a>,
<a name="l00073"></a>00073                             self.<a class="code" href="class__yaml___1_1reader_1_1ReaderError.html#ebf485513c9f0fc822cefabd090c778c">name</a>, self.<a class="code" href="class__yaml___1_1reader_1_1ReaderError.html#397935230abed05bed62ade1f17b4350">position</a>)
<a name="l00074"></a>00074         <span class="keywordflow">else</span>:
<a name="l00075"></a>00075             <span class="keywordflow">return</span> <span class="stringliteral">"unacceptable character #x%04x: %s\n"</span>    \
<a name="l00076"></a>00076                     <span class="stringliteral">"  in \"%s\", position %d"</span>    \
<a name="l00077"></a>00077                     % (ord(self.<a class="code" href="class__yaml___1_1reader_1_1ReaderError.html#30cc034006de77309894f1487090ed9d">character</a>), self.<a class="code" href="class__yaml___1_1reader_1_1ReaderError.html#dbe23c3b4100c06ca07c8419e2760e84">reason</a>,
<a name="l00078"></a>00078                             self.<a class="code" href="class__yaml___1_1reader_1_1ReaderError.html#ebf485513c9f0fc822cefabd090c778c">name</a>, self.<a class="code" href="class__yaml___1_1reader_1_1ReaderError.html#397935230abed05bed62ade1f17b4350">position</a>)
<a name="l00079"></a>00079 
<a name="l00080"></a><a class="code" href="class__yaml___1_1reader_1_1Reader.html">00080</a> <span class="keyword">class </span><a class="code" href="class__yaml___1_1reader_1_1Reader.html">Reader</a>(object):
<a name="l00081"></a>00081     <span class="comment"># Reader:</span>
<a name="l00082"></a>00082     <span class="comment"># - determines the data encoding and converts it to unicode,</span>
<a name="l00083"></a>00083     <span class="comment"># - checks if characters are in allowed range,</span>
<a name="l00084"></a>00084     <span class="comment"># - adds '\0' to the end.</span>
<a name="l00085"></a>00085 
<a name="l00086"></a>00086     <span class="comment"># Reader accepts</span>
<a name="l00087"></a>00087     <span class="comment">#  - a `str` object,</span>
<a name="l00088"></a>00088     <span class="comment">#  - a `unicode` object,</span>
<a name="l00089"></a>00089     <span class="comment">#  - a file-like object with its `read` method returning `str`,</span>
<a name="l00090"></a>00090     <span class="comment">#  - a file-like object with its `read` method returning `unicode`.</span>
<a name="l00091"></a>00091 
<a name="l00092"></a>00092     <span class="comment"># Yeah, it's ugly and slow.</span>
<a name="l00093"></a>00093 
<a name="l00094"></a><a class="code" href="class__yaml___1_1reader_1_1Reader.html#c7167a8e975559a7755c030a0d2973bb">00094</a>     <span class="keyword">def </span><a class="code" href="class__yaml___1_1reader_1_1Reader.html#c7167a8e975559a7755c030a0d2973bb">__init__</a>(self, stream):
<a name="l00095"></a><a class="code" href="class__yaml___1_1reader_1_1Reader.html#3caaaafeaf38d3f6ce793a84e555617d">00095</a>         self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#3caaaafeaf38d3f6ce793a84e555617d">name</a> = <span class="keywordtype">None</span>
<a name="l00096"></a><a class="code" href="class__yaml___1_1reader_1_1Reader.html#89e157d9a68b879b03e2f3f283cbb077">00096</a>         self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#89e157d9a68b879b03e2f3f283cbb077">stream</a> = <span class="keywordtype">None</span>
<a name="l00097"></a><a class="code" href="class__yaml___1_1reader_1_1Reader.html#b18f506d565a13f2bfac80d4d4de3eb9">00097</a>         self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#b18f506d565a13f2bfac80d4d4de3eb9">stream_pointer</a> = 0
<a name="l00098"></a><a class="code" href="class__yaml___1_1reader_1_1Reader.html#1d48ce4b1a79b0f72bef2f2ca047d204">00098</a>         self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#1d48ce4b1a79b0f72bef2f2ca047d204">eof</a> = <span class="keyword">True</span>
<a name="l00099"></a><a class="code" href="class__yaml___1_1reader_1_1Reader.html#4cde4271e677f544b5ecdc8aac2b7674">00099</a>         self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#4cde4271e677f544b5ecdc8aac2b7674">buffer</a> = <span class="stringliteral">u''</span>
<a name="l00100"></a><a class="code" href="class__yaml___1_1reader_1_1Reader.html#0aec202340cafa885af5e830bd62f611">00100</a>         self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#0aec202340cafa885af5e830bd62f611">pointer</a> = 0
<a name="l00101"></a><a class="code" href="class__yaml___1_1reader_1_1Reader.html#054b7535ac28ed9716d52a7dc5bae41f">00101</a>         self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#054b7535ac28ed9716d52a7dc5bae41f">raw_buffer</a> = <span class="keywordtype">None</span>
<a name="l00102"></a><a class="code" href="class__yaml___1_1reader_1_1Reader.html#e1140cd7bc7a116c41c8df3dfff5b47b">00102</a>         self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#e1140cd7bc7a116c41c8df3dfff5b47b">raw_decode</a> = <span class="keywordtype">None</span>
<a name="l00103"></a><a class="code" href="class__yaml___1_1reader_1_1Reader.html#a9377cc26a9780023568ff231af5e22b">00103</a>         self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#a9377cc26a9780023568ff231af5e22b">encoding</a> = <span class="keywordtype">None</span>
<a name="l00104"></a><a class="code" href="class__yaml___1_1reader_1_1Reader.html#d88c207ef9f54bd5f6e409a189b2cf64">00104</a>         self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#d88c207ef9f54bd5f6e409a189b2cf64">index</a> = 0
<a name="l00105"></a><a class="code" href="class__yaml___1_1reader_1_1Reader.html#ccfc081dbc33800bf610d954f41ba939">00105</a>         self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#ccfc081dbc33800bf610d954f41ba939">line</a> = 0
<a name="l00106"></a><a class="code" href="class__yaml___1_1reader_1_1Reader.html#1099eab33695d706718691b795b829db">00106</a>         self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#1099eab33695d706718691b795b829db">column</a> = 0
<a name="l00107"></a>00107         <span class="keywordflow">if</span> isinstance(stream, unicode):
<a name="l00108"></a>00108             self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#3caaaafeaf38d3f6ce793a84e555617d">name</a> = <span class="stringliteral">"&lt;unicode string&gt;"</span>
<a name="l00109"></a>00109             self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#72d1345a76ab5881608ac1b303a7f268">check_printable</a>(stream)
<a name="l00110"></a>00110             self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#4cde4271e677f544b5ecdc8aac2b7674">buffer</a> = stream+<span class="stringliteral">u'\0'</span>
<a name="l00111"></a>00111         <span class="keywordflow">elif</span> isinstance(stream, str):
<a name="l00112"></a>00112             self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#3caaaafeaf38d3f6ce793a84e555617d">name</a> = <span class="stringliteral">"&lt;string&gt;"</span>
<a name="l00113"></a>00113             self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#054b7535ac28ed9716d52a7dc5bae41f">raw_buffer</a> = stream
<a name="l00114"></a>00114             self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#1cf26b77f5e0bd69735f3d0e11586e73">determine_encoding</a>()
<a name="l00115"></a>00115         <span class="keywordflow">else</span>:
<a name="l00116"></a>00116             self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#89e157d9a68b879b03e2f3f283cbb077">stream</a> = stream
<a name="l00117"></a>00117             self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#3caaaafeaf38d3f6ce793a84e555617d">name</a> = getattr(stream, <span class="stringliteral">'name'</span>, <span class="stringliteral">"&lt;file&gt;"</span>)
<a name="l00118"></a>00118             self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#1d48ce4b1a79b0f72bef2f2ca047d204">eof</a> = <span class="keyword">False</span>
<a name="l00119"></a>00119             self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#054b7535ac28ed9716d52a7dc5bae41f">raw_buffer</a> = <span class="stringliteral">''</span>
<a name="l00120"></a>00120             self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#1cf26b77f5e0bd69735f3d0e11586e73">determine_encoding</a>()
<a name="l00121"></a>00121 
<a name="l00122"></a><a class="code" href="class__yaml___1_1reader_1_1Reader.html#6e96c2b2215c5833c00451d6f6c6e54d">00122</a>     <span class="keyword">def </span><a class="code" href="class__yaml___1_1reader_1_1Reader.html#6e96c2b2215c5833c00451d6f6c6e54d">peek</a>(self, index=0):
<a name="l00123"></a>00123         <span class="keywordflow">try</span>:
<a name="l00124"></a>00124             <span class="keywordflow">return</span> self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#4cde4271e677f544b5ecdc8aac2b7674">buffer</a>[self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#0aec202340cafa885af5e830bd62f611">pointer</a>+index]
<a name="l00125"></a>00125         <span class="keywordflow">except</span> IndexError:
<a name="l00126"></a>00126             self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#649662aacb75316afd9e2bf40ff45c8e">update</a>(index+1)
<a name="l00127"></a>00127             <span class="keywordflow">return</span> self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#4cde4271e677f544b5ecdc8aac2b7674">buffer</a>[self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#0aec202340cafa885af5e830bd62f611">pointer</a>+index]
<a name="l00128"></a>00128 
<a name="l00129"></a><a class="code" href="class__yaml___1_1reader_1_1Reader.html#f2d3bb39465f421e6acb9fa9d5ff900c">00129</a>     <span class="keyword">def </span><a class="code" href="class__yaml___1_1reader_1_1Reader.html#f2d3bb39465f421e6acb9fa9d5ff900c">prefix</a>(self, length=1):
<a name="l00130"></a>00130         <span class="keywordflow">if</span> self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#0aec202340cafa885af5e830bd62f611">pointer</a>+length &gt;= len(self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#4cde4271e677f544b5ecdc8aac2b7674">buffer</a>):
<a name="l00131"></a>00131             self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#649662aacb75316afd9e2bf40ff45c8e">update</a>(length)
<a name="l00132"></a>00132         <span class="keywordflow">return</span> self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#4cde4271e677f544b5ecdc8aac2b7674">buffer</a>[self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#0aec202340cafa885af5e830bd62f611">pointer</a>:self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#0aec202340cafa885af5e830bd62f611">pointer</a>+length]
<a name="l00133"></a>00133 
<a name="l00134"></a><a class="code" href="class__yaml___1_1reader_1_1Reader.html#0f4e874be06dbda2c2d255902153447b">00134</a>     <span class="keyword">def </span><a class="code" href="class__yaml___1_1reader_1_1Reader.html#0f4e874be06dbda2c2d255902153447b">forward</a>(self, length=1):
<a name="l00135"></a>00135         <span class="keywordflow">if</span> self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#0aec202340cafa885af5e830bd62f611">pointer</a>+length+1 &gt;= len(self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#4cde4271e677f544b5ecdc8aac2b7674">buffer</a>):
<a name="l00136"></a>00136             self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#649662aacb75316afd9e2bf40ff45c8e">update</a>(length+1)
<a name="l00137"></a>00137         <span class="keywordflow">while</span> length:
<a name="l00138"></a>00138             ch = self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#4cde4271e677f544b5ecdc8aac2b7674">buffer</a>[self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#0aec202340cafa885af5e830bd62f611">pointer</a>]
<a name="l00139"></a>00139             self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#0aec202340cafa885af5e830bd62f611">pointer</a> += 1
<a name="l00140"></a>00140             self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#d88c207ef9f54bd5f6e409a189b2cf64">index</a> += 1
<a name="l00141"></a>00141             <span class="keywordflow">if</span> ch <span class="keywordflow">in</span> <span class="stringliteral">u'\n\x85\u2028\u2029'</span>  \
<a name="l00142"></a>00142                     <span class="keywordflow">or</span> (ch == <span class="stringliteral">u'\r'</span> <span class="keywordflow">and</span> self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#4cde4271e677f544b5ecdc8aac2b7674">buffer</a>[self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#0aec202340cafa885af5e830bd62f611">pointer</a>] != <span class="stringliteral">u'\n'</span>):
<a name="l00143"></a>00143                 self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#ccfc081dbc33800bf610d954f41ba939">line</a> += 1
<a name="l00144"></a>00144                 self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#1099eab33695d706718691b795b829db">column</a> = 0
<a name="l00145"></a>00145             <span class="keywordflow">elif</span> ch != <span class="stringliteral">u'\uFEFF'</span>:
<a name="l00146"></a>00146                 self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#1099eab33695d706718691b795b829db">column</a> += 1
<a name="l00147"></a>00147             length -= 1
<a name="l00148"></a>00148 
<a name="l00149"></a><a class="code" href="class__yaml___1_1reader_1_1Reader.html#ac8465d401fd4f8e82a9b411fe218d12">00149</a>     <span class="keyword">def </span><a class="code" href="class__yaml___1_1reader_1_1Reader.html#ac8465d401fd4f8e82a9b411fe218d12">get_mark</a>(self):
<a name="l00150"></a>00150         <span class="keywordflow">if</span> self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#89e157d9a68b879b03e2f3f283cbb077">stream</a> <span class="keywordflow">is</span> <span class="keywordtype">None</span>:
<a name="l00151"></a>00151             <span class="keywordflow">return</span> Mark(self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#3caaaafeaf38d3f6ce793a84e555617d">name</a>, self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#d88c207ef9f54bd5f6e409a189b2cf64">index</a>, self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#ccfc081dbc33800bf610d954f41ba939">line</a>, self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#1099eab33695d706718691b795b829db">column</a>,
<a name="l00152"></a>00152                     self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#4cde4271e677f544b5ecdc8aac2b7674">buffer</a>, self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#0aec202340cafa885af5e830bd62f611">pointer</a>)
<a name="l00153"></a>00153         <span class="keywordflow">else</span>:
<a name="l00154"></a>00154             <span class="keywordflow">return</span> Mark(self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#3caaaafeaf38d3f6ce793a84e555617d">name</a>, self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#d88c207ef9f54bd5f6e409a189b2cf64">index</a>, self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#ccfc081dbc33800bf610d954f41ba939">line</a>, self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#1099eab33695d706718691b795b829db">column</a>,
<a name="l00155"></a>00155                     <span class="keywordtype">None</span>, <span class="keywordtype">None</span>)
<a name="l00156"></a>00156 
<a name="l00157"></a><a class="code" href="class__yaml___1_1reader_1_1Reader.html#1cf26b77f5e0bd69735f3d0e11586e73">00157</a>     <span class="keyword">def </span><a class="code" href="class__yaml___1_1reader_1_1Reader.html#1cf26b77f5e0bd69735f3d0e11586e73">determine_encoding</a>(self):
<a name="l00158"></a>00158         <span class="keywordflow">while</span> <span class="keywordflow">not</span> self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#1d48ce4b1a79b0f72bef2f2ca047d204">eof</a> <span class="keywordflow">and</span> len(self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#054b7535ac28ed9716d52a7dc5bae41f">raw_buffer</a>) &lt; 2:
<a name="l00159"></a>00159             self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#2e3ba197d926d21e1822de119184d6e2">update_raw</a>()
<a name="l00160"></a>00160         <span class="keywordflow">if</span> <span class="keywordflow">not</span> isinstance(self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#054b7535ac28ed9716d52a7dc5bae41f">raw_buffer</a>, unicode):
<a name="l00161"></a>00161             <span class="keywordflow">if</span> self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#054b7535ac28ed9716d52a7dc5bae41f">raw_buffer</a>.startswith(codecs.BOM_UTF16_LE):
<a name="l00162"></a>00162                 self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#e1140cd7bc7a116c41c8df3dfff5b47b">raw_decode</a> = utf_16_le_decode
<a name="l00163"></a>00163                 self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#a9377cc26a9780023568ff231af5e22b">encoding</a> = <span class="stringliteral">'utf-16-le'</span>
<a name="l00164"></a>00164             <span class="keywordflow">elif</span> self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#054b7535ac28ed9716d52a7dc5bae41f">raw_buffer</a>.startswith(codecs.BOM_UTF16_BE):
<a name="l00165"></a>00165                 self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#e1140cd7bc7a116c41c8df3dfff5b47b">raw_decode</a> = utf_16_be_decode
<a name="l00166"></a>00166                 self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#a9377cc26a9780023568ff231af5e22b">encoding</a> = <span class="stringliteral">'utf-16-be'</span>
<a name="l00167"></a>00167             <span class="keywordflow">else</span>:
<a name="l00168"></a>00168                 self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#e1140cd7bc7a116c41c8df3dfff5b47b">raw_decode</a> = utf_8_decode
<a name="l00169"></a>00169                 self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#a9377cc26a9780023568ff231af5e22b">encoding</a> = <span class="stringliteral">'utf-8'</span>
<a name="l00170"></a>00170         self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#649662aacb75316afd9e2bf40ff45c8e">update</a>(1)
<a name="l00171"></a>00171 
<a name="l00172"></a><a class="code" href="class__yaml___1_1reader_1_1Reader.html#270490653019399941fcb519425f010d">00172</a>     NON_PRINTABLE = re.compile(<span class="stringliteral">u'[^\x09\x0A\x0D\x20-\x7E\x85\xA0-\uD7FF\uE000-\uFFFD]'</span>)
<a name="l00173"></a><a class="code" href="class__yaml___1_1reader_1_1Reader.html#72d1345a76ab5881608ac1b303a7f268">00173</a>     <span class="keyword">def </span><a class="code" href="class__yaml___1_1reader_1_1Reader.html#72d1345a76ab5881608ac1b303a7f268">check_printable</a>(self, data):
<a name="l00174"></a>00174         match = self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#270490653019399941fcb519425f010d">NON_PRINTABLE</a>.search(data)
<a name="l00175"></a>00175         <span class="keywordflow">if</span> match:
<a name="l00176"></a>00176             character = match.group()
<a name="l00177"></a>00177             position = self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#d88c207ef9f54bd5f6e409a189b2cf64">index</a>+(len(self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#4cde4271e677f544b5ecdc8aac2b7674">buffer</a>)-self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#0aec202340cafa885af5e830bd62f611">pointer</a>)+match.start()
<a name="l00178"></a>00178             <span class="keywordflow">raise</span> ReaderError(self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#3caaaafeaf38d3f6ce793a84e555617d">name</a>, position, character,
<a name="l00179"></a>00179                     <span class="stringliteral">'unicode'</span>, <span class="stringliteral">"special characters are not allowed"</span>)
<a name="l00180"></a>00180 
<a name="l00181"></a><a class="code" href="class__yaml___1_1reader_1_1Reader.html#649662aacb75316afd9e2bf40ff45c8e">00181</a>     <span class="keyword">def </span><a class="code" href="class__yaml___1_1reader_1_1Reader.html#649662aacb75316afd9e2bf40ff45c8e">update</a>(self, length):
<a name="l00182"></a>00182         <span class="keywordflow">if</span> self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#054b7535ac28ed9716d52a7dc5bae41f">raw_buffer</a> <span class="keywordflow">is</span> <span class="keywordtype">None</span>:
<a name="l00183"></a>00183             <span class="keywordflow">return</span>
<a name="l00184"></a>00184         self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#4cde4271e677f544b5ecdc8aac2b7674">buffer</a> = self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#4cde4271e677f544b5ecdc8aac2b7674">buffer</a>[self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#0aec202340cafa885af5e830bd62f611">pointer</a>:]
<a name="l00185"></a>00185         self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#0aec202340cafa885af5e830bd62f611">pointer</a> = 0
<a name="l00186"></a>00186         <span class="keywordflow">while</span> len(self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#4cde4271e677f544b5ecdc8aac2b7674">buffer</a>) &lt; length:
<a name="l00187"></a>00187             <span class="keywordflow">if</span> <span class="keywordflow">not</span> self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#1d48ce4b1a79b0f72bef2f2ca047d204">eof</a>:
<a name="l00188"></a>00188                 self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#2e3ba197d926d21e1822de119184d6e2">update_raw</a>()
<a name="l00189"></a>00189             <span class="keywordflow">if</span> self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#e1140cd7bc7a116c41c8df3dfff5b47b">raw_decode</a> <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:
<a name="l00190"></a>00190                 <span class="keywordflow">try</span>:
<a name="l00191"></a>00191                     data, converted = self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#e1140cd7bc7a116c41c8df3dfff5b47b">raw_decode</a>(self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#054b7535ac28ed9716d52a7dc5bae41f">raw_buffer</a>,
<a name="l00192"></a>00192                             <span class="stringliteral">'strict'</span>, self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#1d48ce4b1a79b0f72bef2f2ca047d204">eof</a>)
<a name="l00193"></a>00193                 <span class="keywordflow">except</span> UnicodeDecodeError, exc:
<a name="l00194"></a>00194                     character = exc.object[exc.start]
<a name="l00195"></a>00195                     <span class="keywordflow">if</span> self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#89e157d9a68b879b03e2f3f283cbb077">stream</a> <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:
<a name="l00196"></a>00196                         position = self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#b18f506d565a13f2bfac80d4d4de3eb9">stream_pointer</a>-len(self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#054b7535ac28ed9716d52a7dc5bae41f">raw_buffer</a>)+exc.start
<a name="l00197"></a>00197                     <span class="keywordflow">else</span>:
<a name="l00198"></a>00198                         position = exc.start
<a name="l00199"></a>00199                     <span class="keywordflow">raise</span> ReaderError(self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#3caaaafeaf38d3f6ce793a84e555617d">name</a>, position, character,
<a name="l00200"></a>00200                             exc.encoding, exc.reason)
<a name="l00201"></a>00201             <span class="keywordflow">else</span>:
<a name="l00202"></a>00202                 data = self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#054b7535ac28ed9716d52a7dc5bae41f">raw_buffer</a>
<a name="l00203"></a>00203                 converted = len(data)
<a name="l00204"></a>00204             self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#72d1345a76ab5881608ac1b303a7f268">check_printable</a>(data)
<a name="l00205"></a>00205             self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#4cde4271e677f544b5ecdc8aac2b7674">buffer</a> += data
<a name="l00206"></a>00206             self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#054b7535ac28ed9716d52a7dc5bae41f">raw_buffer</a> = self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#054b7535ac28ed9716d52a7dc5bae41f">raw_buffer</a>[converted:]
<a name="l00207"></a>00207             <span class="keywordflow">if</span> self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#1d48ce4b1a79b0f72bef2f2ca047d204">eof</a>:
<a name="l00208"></a>00208                 self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#4cde4271e677f544b5ecdc8aac2b7674">buffer</a> += <span class="stringliteral">u'\0'</span>
<a name="l00209"></a>00209                 self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#054b7535ac28ed9716d52a7dc5bae41f">raw_buffer</a> = <span class="keywordtype">None</span>
<a name="l00210"></a>00210                 <span class="keywordflow">break</span>
<a name="l00211"></a>00211 
<a name="l00212"></a><a class="code" href="class__yaml___1_1reader_1_1Reader.html#2e3ba197d926d21e1822de119184d6e2">00212</a>     <span class="keyword">def </span><a class="code" href="class__yaml___1_1reader_1_1Reader.html#2e3ba197d926d21e1822de119184d6e2">update_raw</a>(self, size=1024):
<a name="l00213"></a>00213         data = self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#89e157d9a68b879b03e2f3f283cbb077">stream</a>.read(size)
<a name="l00214"></a>00214         <span class="keywordflow">if</span> data:
<a name="l00215"></a>00215             self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#054b7535ac28ed9716d52a7dc5bae41f">raw_buffer</a> += data
<a name="l00216"></a>00216             self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#b18f506d565a13f2bfac80d4d4de3eb9">stream_pointer</a> += len(data)
<a name="l00217"></a>00217         <span class="keywordflow">else</span>:
<a name="l00218"></a>00218             self.<a class="code" href="class__yaml___1_1reader_1_1Reader.html#1d48ce4b1a79b0f72bef2f2ca047d204">eof</a> = <span class="keyword">True</span>
<a name="l00219"></a>00219 
<a name="l00220"></a>00220 <span class="comment">#try:</span>
<a name="l00221"></a>00221 <span class="comment">#    import psyco</span>
<a name="l00222"></a>00222 <span class="comment">#    psyco.bind(Reader)</span>
<a name="l00223"></a>00223 <span class="comment">#except ImportError:</span>
<a name="l00224"></a>00224 <span class="comment">#    pass</span>
<a name="l00225"></a>00225 
</pre></div><hr size="1"><address style="text-align: right;"><small>Generated on Tue Nov 27 11:56:03 2007 for IGA framework by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.3 </small></address>
</body>
</html>
